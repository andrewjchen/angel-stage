#! /usr/bin/env python3
# encoding: utf-8

def options(opt):
    pass

def configure(conf):
    pass

from os.path import join
def build(bld):
    sdl_libs = ['SDL', 'SDL_image']
    allegro_libs = ['allegro', 'allegro_image']
    common_includes = ['.',
                       join(bld.top_dir, 'include'),
                       join(bld.top_dir, 'deps', 'usr', 'local', 'include'),
                       join(bld.top_dir, 'include', 'shared')]
    common_libpath = [join(bld.top_dir, 'deps', 'usr', 'local', 'lib')]
    client_includes = common_includes + [join(bld.top_dir, 'include', 'client')]
    server_includes = common_includes + [join(bld.top_dir, 'include', 'server')]
    bld.user_vars = dict()
    bld.user_vars['common_includes'] = common_includes
    common_lib = ['boost_system', 'boost_thread','SDL_net']
    bld.user_vars['common_lib'] = common_lib
    bld.recurse('shared')
    bld.recurse('client')
    bld.recurse('server')
    bld.program(
                source = 'allegro_main.c', 
                target = 'allegro_main', 
                lib = allegro_libs, 
                libpath = common_libpath,
                includes = common_includes, 
                )
    bld.program(
                source = 'sdl_main.c', 
                target = 'sdl_main', 
                lib = sdl_libs,
                lib_path = common_libpath,
                includes = common_includes, 
                )
    bld.program(
                source = 'sdl_main.cxx', 
                target = 'sdl_main_cxx', 
                lib = sdl_libs,
                lib_path = common_libpath,
                includes = common_includes, 
                )
    bld.program(
                source = ['client/client_main.cxx',
                          'client/NetworkConnecter.cxx',
                          'shared/PacketTransporter.cxx',
                          'client/MapRenderer.cxx',
                          'shared/GameState.cxx',
                          'shared/Event.cxx',
                          'shared/Entity.cxx',
                          'client/sharedside_client.cxx',
                          'shared/Packet.cxx'],
                target = 'client_main',
                includes = client_includes, 
                lib = common_lib + allegro_libs,
                )
    bld.program(
                source = ['server/server_main.cxx',
                          'server/sharedside_server.cxx',
                          'shared/GameState.cxx',
                          'server/ClientsConnection.cxx',
                          'shared/PacketTransporter.cxx',
                          'shared/Event.cxx',
                          'shared/Entity.cxx',
                          'shared/Packet.cxx'],
                target = 'server_main',
                includes = server_includes, 
                lib = common_lib,
                )
